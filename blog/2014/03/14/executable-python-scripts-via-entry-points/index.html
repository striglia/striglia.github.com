<!doctype html>
<html lang="">	
<head>
	<meta charset="utf-8"/>
	<title>"Executable python scripts via entry points" - Locally Optimal</title>	
	<meta name="author" content="Scott Triglia">
	

  <meta name="description" content="A quick topic -- executing a python module from the command line!">

	<meta name="twitter:card" content="summary">
	  <meta name="twitter:creator" content="@scott_triglia">
	<meta name="twitter:title" content=""Executable python scripts via entry points"">
	<meta name="twitter:description" content="A quick topic -- executing a python module from the command line!">
	<meta name="twitter:url" content="http://www.locallyoptimal.com/blog/2014/03/14/executable-python-scripts-via-entry-points/">


	<link rel="stylesheet" href="http://www.locallyoptimal.com/theme/css/main.css" type="text/css" />
		
	  <script type="text/javascript" src="http://www.locallyoptimal.com/theme/js/custom_scripts.js"></script>


    <link href="http://www.locallyoptimal.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Locally Optimal Atom Feed" />
</head>
	
<body>

    <div class="container">
	  
	  <header role="banner">
	    <div class="feeds">
	      <a href="http://www.locallyoptimal.com/feeds/all.atom.xml" rel="alternate"><img src="http://www.locallyoptimal.com/theme/images/icons/feed-32px.png" alt="atom feed"/></a>
	    </div>
		<a href="http://www.locallyoptimal.com" class="title">Locally Optimal</a>
      </header>
	
	  <div class="wrapper">

		  <div role="main" class="content">
	<article class="full">
		
		<h1>"Executable python scripts via entry points"</h1>
		
<div class="metadata">
  <time datetime="2014-03-14T16:11:00-07:00" pubdate>Fri 14 March 2014</time>
    <address class="vcard author">
      by <a class="url fn" href="http://www.locallyoptimal.com/author/scott-triglia.html">Scott Triglia</a>
    </address>
  in <a href="http://www.locallyoptimal.com/category/python.html">python</a>
</div>		
		<p>A quick topic -- executing a python module from the command line!</p>


<p>When <a href="http://locallyoptimal.com/blog/2014/03/14/building-a-basic-package-pt-1-bare-bones/">I last left</a> my pet rss2sms project, it had been transformed into a basic python package. Unfortunately, this means that my old method of running <code>python rss2sms.py --foobar</code> from the command line is not so simple anymore. In fact what I really want is to be able to just run <code>rss2sms --foobar</code> from the command line after I install the package.</p>
<p>Luckily python has exactly what we need in the form of setuptools's <a href="http://pythonhosted.org//setuptools/setuptools.html#automatic-script-creation">console_script argument to entry_points</a>.</p>
<p>Let's go ahead and add it to our setup.py:</p>
<div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rss2sms&quot;</span><span class="p">,</span>                                                             
    <span class="n">version</span><span class="o">=</span><span class="n">find_version</span><span class="p">(</span><span class="s1">&#39;rss2sms&#39;</span><span class="p">,</span> <span class="s1">&#39;__init__.py&#39;</span><span class="p">),</span>                             

<span class="c1"># ...the rest of our setup.py here....</span>

    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>                                                              
        <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>                                                    
            <span class="s1">&#39;rss2sms=rss2sms:main&#39;</span><span class="p">,</span>                                             
        <span class="p">],</span>                                                                      
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>


<p>So simple! Note that we're linking the executable <code>rss2sms</code> here to running the python function <code>main</code> in the <code>rss2sms</code> module. If we look at that function, it just does the normal command line parsing and function calling that it always has.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>                                                                     
    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>                                                     
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-u&quot;</span><span class="p">,</span> <span class="s2">&quot;--url&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;rss_url&quot;</span><span class="p">,</span>                            
                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;url of rss feed&quot;</span><span class="p">)</span>                             
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;--to&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;to_num&quot;</span><span class="p">,</span>                              
                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;cell number to send sms alerts to&quot;</span><span class="p">)</span>           
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--from&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;from_num&quot;</span><span class="p">,</span>                          
                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;cell number to send sms alerts to (overrides environment variable TWILIO_NUMBER)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;--id&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;rss_id_field&quot;</span><span class="p">,</span>                        
                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;unique id rss field used for display in SMS and for equality comparison (defaults to &#39;link&#39;)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="s2">&quot;--display&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;rss_display_field&quot;</span><span class="p">,</span>              
                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;name of rss field used for display in SMS (defaults to &#39;title&#39;)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;--cache-filename&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cache_filename&quot;</span><span class="p">,</span>          
                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;optional file to cache last post in&quot;</span><span class="p">)</span>         

    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>                                       
    <span class="n">rss2sms</span> <span class="o">=</span> <span class="n">Rss2Sms</span><span class="p">(</span><span class="o">**</span><span class="nb">vars</span><span class="p">(</span><span class="n">options</span><span class="p">))</span>                                          
    <span class="n">rss2sms</span><span class="o">.</span><span class="n">parse_and_alert</span><span class="p">()</span> 
</pre></div>


<p>Now let's start up a fresh virtualenv and test it out. We can use pip's develop option to install a package by just passing it a path.</p>
<div class="highlight"><pre><span></span>~/Desktop/github/rss2sms (master) $ virtualenv entry_point_test; source entry_point_test/bin/activate
New python executable in entry_point_test/bin/python
Installing Setuptools...........done.
Installing Pip..................done.
(entry_point_test) ~/Desktop/github/rss2sms (master) $ pip install -e .

... lots of text from installation...

(entry_point_test) ~/Desktop/github/rss2sms (master) $ rss2sms --help
Usage: rss2sms [options]

Options:
  -h, --help            show this help message and exit
  -u RSS_URL, --url=RSS_URL
                        url of rss feed
  -t TO_NUM, --to=TO_NUM
                        cell number to send sms alerts to
  -f FROM_NUM, --from=FROM_NUM
                        cell number to send sms alerts to (overrides
                        environment variable TWILIO_NUMBER)
  -i RSS_ID_FIELD, --id=RSS_ID_FIELD
                        unique id rss field used for display in SMS and for
                        equality comparison (defaults to &#39;link&#39;)
  -d RSS_DISPLAY_FIELD, --display=RSS_DISPLAY_FIELD
                        name of rss field used for display in SMS (defaults to
                        &#39;title&#39;)
  -c CACHE_FILENAME, --cache-filename=CACHE_FILENAME
                        optional file to cache last post in
</pre></div>


<p>And just like that we have an executable hooked up our python module. We can even use which to see how it works:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">entry_point_test</span><span class="p">)</span> <span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">rss2sms</span> <span class="p">(</span><span class="n">master</span><span class="p">)</span> <span class="err">$</span> <span class="n">which</span> <span class="n">rss2sms</span>
<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">striglia</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">rss2sms</span><span class="o">/</span><span class="n">entry_point_test</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">rss2sms</span>
<span class="p">(</span><span class="n">entry_point_test</span><span class="p">)</span> <span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">rss2sms</span> <span class="p">(</span><span class="n">master</span><span class="p">)</span> <span class="err">$</span> <span class="n">cat</span> <span class="sb">`which rss2sms`</span>
<span class="c1">#!/Users/striglia/Desktop/github/rss2sms/entry_point_test/bin/python            </span>
<span class="c1"># EASY-INSTALL-ENTRY-SCRIPT: &#39;rss2sms==0.0.1&#39;,&#39;console_scripts&#39;,&#39;rss2sms&#39;          </span>
<span class="n">__requires__</span> <span class="o">=</span> <span class="s1">&#39;rss2sms==0.0.1&#39;</span>                                                 
<span class="kn">import</span> <span class="nn">sys</span>                                                                      
<span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">load_entry_point</span>                                      

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>                                                      
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>                                                                   
        <span class="n">load_entry_point</span><span class="p">(</span><span class="s1">&#39;rss2sms==0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;console_scripts&#39;</span><span class="p">,</span> <span class="s1">&#39;rss2sms&#39;</span><span class="p">)()</span>         
    <span class="p">)</span>  
</pre></div>


<p>This executable is just a simple python module which, when we call it, uses the pkg_resources library to look up what python module our setup.py says we should call. All in all, a very painless way to distribute nice executables for your library.</p>	

	</article>

    <p>
	<a href="https://twitter.com/share" class="twitter-share-button" data-via="" data-lang="en" data-size="large" data-related="">Tweet</a>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
	</p>

	<div class="comments">
	<h2>Comments !</h2>
	    <div id="disqus_thread"></div>
	    <script type="text/javascript">
	       var disqus_identifier = "blog/2014/03/14/executable-python-scripts-via-entry-points/";
	       (function() {
	       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	       dsq.src = 'http://locallyoptimal.disqus.com/embed.js';
	       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	      })();
	    </script>
	</div>

		  </div>	
		  
		  <div class="sidebar">
		    <div class="sidebar-container" id="sidebar-container-fixed">

	            <aside>
	              <h2>About</h2>
			      <p>
                    I'm Scott Triglia 👋 I mostly write here about software, technical leadership, and public speaking.
			      </p>
			    </aside>

		  <!-- Begin Mailchimp Signup Form -->
                  <link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
                  <style type="text/css">
                  	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
                  	/* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
                  	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
                  </style>
                  <div id="mc_embed_signup">
                  <form action="https://locallyoptimal.us10.list-manage.com/subscribe/post?u=d3758fa7ff1fe8c1066912e42&amp;id=9fa41553a4" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                      <div id="mc_embed_signup_scroll">
                  	<label for="mce-EMAIL">Get new posts weekly</label>
                  	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
                      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_d3758fa7ff1fe8c1066912e42_9fa41553a4" tabindex="-1" value=""></div>
                      <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                      </div>
                  </form>
                  </div>

<!--End mc_embed_signup-->

  	          <nav>
	            <h2>Categories</h2>
	            <ul>
	                <li ><a href="http://www.locallyoptimal.com/category/conferences.html">conferences</a></li>
	                <li ><a href="http://www.locallyoptimal.com/category/intervewing.html">intervewing</a></li>
	                <li ><a href="http://www.locallyoptimal.com/category/leadership.html">leadership</a></li>
	                <li ><a href="http://www.locallyoptimal.com/category/misc.html">misc</a></li>
	                <li class="active"><a href="http://www.locallyoptimal.com/category/python.html">python</a></li>
	                <li ><a href="http://www.locallyoptimal.com/category/testing.html">testing</a></li>
	                <li ><a href="http://www.locallyoptimal.com/category/time-management.html">time-management</a></li>
	            </ul>
	          </nav>

	            <aside>
	            <h2>Social</h2>
			      <ul class="social">
				    <li><a href="http://www.twitter.com/scott_triglia">Twitter</a><i></i></li>
				    <li><a href="http://www.github.com/striglia">Github</a><i></i></li>
				    <li><a href="http://www.linkedin.com/in/striglia">LinkedIn</a><i></i></li>
			      </ul>
			    </aside>

	        </div>
		  </div>

	  </div>

      <footer>
		<p role="contentinfo">
		  Scott Triglia - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-sober">pelican-sober</a>.
    	</p>

	  </footer>	

	</div>
	
	  <script>
		var _gaq=[['_setAccount','UA-35190779-1'],['_trackPageview']];
		(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
		g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
		s.parentNode.insertBefore(g,s)}(document,'script'));
	  </script>

</body>
</html>